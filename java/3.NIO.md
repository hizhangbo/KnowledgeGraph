# Non-Blocking IO(New IO)
- 本质
  - 多路复用(Selector)
  - 事件驱动(Channel)
  - 面向缓冲区（块）编程(Buffer)
- Channel
  - 作用
    - 建立连接，类似BIO中socket
  - 特性
    - 双向性
    - 非阻塞性
    - 操作唯一性
  - 实现
    - File:FileChannel
    - UDP:DatagramChannel
    - TCP:ServerSocketChannel/SocketChannel
- Buffer
  - 作用
    - 读写Channel中的数据，flip方法切换读写模式
  - 本质
    - 一块内存区域
  - 属性
    - Capacity：最大写入容量
    - Position：写入时标记写入位，读取时标记可读位
    - Limit：写入时上限等于Capacity，读取上限可标记为Position
    - Mark：标记Position位置，reset时恢复到此位置
- Selector
  - 作用
    - I/O就绪选择，NIO网络编程的基础
  - SelectionKey
    - 作用
      - 提供4种Selector可监听的静态常量值
    - 4个事件
      - OP_READ：读就绪
      - OP_WRITE：写就绪
      - OP_CONNECT：连接就绪
      - OP_ACCEPT：接收就绪
  - 使用
    - Channel注册到Selector上
- NIO编程实现步骤
  - 1. 创建Selector
    2. 创建ServerSocketChannel，绑定监听端口
    3. 将Chanel设置为非阻塞模式
    4. 将Channel注册到Selector上，监听连接事件
    5. 循环调用Selector的select方法，检测就绪情况
    6. 调用selectedKeys方法获取就绪channel集合
    7. 判断就绪事件种类，调用业务处理方法
    8. 根据业务需要决定是否再次注册监听事件，重复执行第三步操作
- 原生缺陷
  - NIO类库和API繁杂
  - 可靠性能力补齐，工作量和难度非常大（这是在真实生产场景中常见的现象，往往只考虑快速实现，对于异常情况考虑不够全面）
  - Selector空轮询，CPU占用100%